# Домашние задания

## h/w #1 (Lesson 1. Database design)
- [x] cпроектировать базу данных 
- [x] Реализуйте сущности продукты, категории продуктов, цены, поставщики, производители, покупатели и покупки. Свои решения для этой схемы приветствуются 
- [x] В проекте должны быть 
  - [x] схема 
  - [x] описание таблиц и полей 
  - [x] примеры бизнес-задач которые решает база

### Реализованные сущности (структура БД, описание таблиц и полей находится [тут](https://app.sqldbm.com/PostgreSQL/Edit/p263715/)):

- [x] пользователь
- [x] таблица для хранения подписок на других пользователей
- [x] таблица для хранения любимых рецептов
- [x] продукты
  - [x] наименование (англ + рус)
  - [x] КБЖУ на 100г
  - [x] категории (рыба / мясо / молочка / овощи / фрукты ...)
- [x] рецепты
  - [x] наименование блюда
  - [x] кол-во порций - default value
  - [x] КБЖУ на 1 порцию
  - [x] фото финального блюда
  - [x] время приготовления
  - [x] сложность приготовления
  - [x] категории (англ + рус)
    - Рецепты блюд по времени приема пищи: завтрак / обед / ужин / перекус / полдник
    - Рецепты по типу блюд: закуска / десерт / суп / первое блюдо / второе блюдо / напитки / гарнир / салат и т.п.
    - Рецепты с использованием: духовка / плита / микроволновка
    - Рецепты по способу приготовления блюд: выпекать / варить / жарить / тушить
    - Рецепты национальных кухонь: Русская кухня / Французская кухня / Итальянская кухня / Азиатская кухня
    - Основа блюда: мясо / рыба  / овощи / птица / морепродукты / тесто
    - Рецепты блюд по событию: Новый год / Великий пост / Пасха / День благодарения
    - Другое: пп
  - [x] этапы приготовления
    - [x] фото этапов приготовления блюда
    - [x] описание
  - [x] ингредиенты 
    - [x] кол-во ингредиентов на 1 порцию
    - [x] единицы измерений
- [x] список покупок (хранит в себе не только список и кол-во продуктов, которые необходимо купить, но и список блюд и кол-во порций по каждому)
  - [x] продукты
    - название
    - кол-во (сумма по всем рецептам)
    - единицы измерений
  - [x] рецепты
    - названия
    - кол-во порций
- [x] отзывы на рецепты

# h/w #2 (Lesson 2. DBMS components)
- [ ] Добавляем в модель данных дополнительные индексы и ограничения
- [ ] Проводим анализ возможных запросов\отчетов\поиска данных. 
- [ ] Предполагаем возможную кардинальность поля. 
- [ ] Создаем дополнительные индексы - простые или композитные. 
- [ ] На каждый индекс пишем краткое описание зачем он нужен (почему по этому полю\полям). 
- [ ] Думаем какие логические ограничения в БД нужно добавить - например какие поля должны быть уникальны, в какие нужно добавить условия, чтобы не нарушить бизнес логику. Пример - нельзя провести операцию по переводу средств на отрицательную сумму. 
- [ ] Создаем ограничения по выбранным полям

## h/w #3 (Lesson 6. PostgreSQL cluster)
- [x] Развернуть контейнер с PostgreSQL или установить СУБД на виртуальную машину. 
- [x] Запустить сервер. 
- [x] Создать клиента с подключением к базе данных postgres через командную строку. 
- [x] Подключиться к серверу используя pgAdmin или другое аналогичное приложение.

## h/w #4 (Lesson 7. DDL)
- [x] Используя операторы DDL создать:
  - [x] Базу данных 
  - [ ] Табличные пространства
  - [x] Роли
  - [x] Схему данных
  - [x] Таблицы своего проекта, распределив их по схемам
  - [ ] Распределить таблицы по табличным пространствам

## h/w #5 (Lesson 9. DML: вставка, обновление, удаление, выборка данных)

- Написать запрос с конструкциями SELECT, JOIN 
- Написать запрос с добавлением данных INSERT INTO 
- Написать запрос с обновлением данных с UPDATE FROM
- Использовать using для оператора DELETE 

---

- [x] Напишите запрос по своей базе с регулярным выражением, добавьте пояснение, что вы хотите найти
- [x] Напишите запрос по своей базе с использованием LEFT JOIN и INNER JOIN, как порядок соединений в FROM влияет на результат? Почему?
- [x] Напишите запрос на добавление данных с выводом информации о добавленных строках.
- [x] Напишите запрос с обновлением данных используя UPDATE FROM. 
- [x] Напишите запрос для удаления данных с оператором DELETE используя join с другой таблицей с помощью using. 
- [ ] *Приведите пример использования утилиты COPY

## h/w #6 (Lesson 11. Index)

- Создать индексы на БД, которые ускорят доступ к данным.
- В данном задании тренируются навыки:
  - определения узких мест 
  - написания запросов для создания индекса 
  - оптимизации

---

- [x] Создать индекс к какой-либо из таблиц вашей БД
  - [x] Создать индексы для всех внешних ключей
- [ ] Прислать текстом результат команды explain, в которой используется данный индекс 
- [ ] Реализовать индекс для полнотекстового поиска 
- [ ] Реализовать индекс на часть таблицы или индекс на поле с функцией
- [ ] Создать индекс на несколько полей
- [ ] Написать комментарии к каждому из индексов
- [ ] Описать что и как делали и с какими проблемами столкнулись

## h/w #7 (Lesson 12. DML: агрегация и сортировка, CTE, аналитические функции)

Посчитать кол-во очков по всем игрокам за текущий год и за предыдущий.

Цель:
Научиться использовать функцию LAG и CTE

Пошаговая инструкция выполнения домашнего задания:

- [x] Создайте таблицу и наполните ее данными
    ```sql
    CREATE TABLE statistic(
      player_name VARCHAR(100) NOT NULL,
      player_id INT NOT NULL,
      year_game SMALLINT NOT NULL CHECK (year_game > 0),
      points DECIMAL(12,2) CHECK (points >= 0),
      PRIMARY KEY (player_name,year_game)
    );
    ```

- [x] заполнить данными
  ```sql
  INSERT INTO statistic(player_name, player_id, year_game, points)
  VALUES  ('Mike',1,2018,18),
          ('Jack',2,2018,14),
          ('Jackie',3,2018,30),
          ('Jet',4,2018,30),
          ('Luke',1,2019,16),
          ('Mike',2,2019,14),
          ('Jack',3,2019,15),
          ('Jackie',4,2019,28),
          ('Jet',5,2019,25),
          ('Luke',1,2020,19),
          ('Mike',2,2020,17),
          ('Jack',3,2020,18),
          ('Jackie',4,2020,29),
          ('Jet',5,2020,27);
  ```

- [x] написать запрос суммы очков с группировкой и сортировкой по годам
  ```sql
  select s.year_game,
         sum(s.points)
  from statistic s
  group by s.year_game
  order by s.year_game
  ```
- [x] написать cte показывающее тоже самое
  ```sql
  WITH cte AS (select s.year_game,
                    sum(s.points)
             from statistic s
             group by s.year_game
             order by s.year_game)
  SELECT *
  FROM cte;
  ```

- [x] используя функцию LAG вывести кол-во очков по всем игрокам за текущий код и за предыдущий.
  ```sql
  select year_game,
         sum(points) as points_current_year,
         lag(sum(points), 1)  over (order by year_game) as points_prev_year
  from statistic
  group by year_game;
  ```